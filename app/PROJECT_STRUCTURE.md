# ðŸ›£ï¸ MagRoad-Prompt Road Network Extraction Tool - Project Structure Guide

This document provides an overview of the internal structure of the Interactive Road Network Extraction Tool (MagRoad-Prompt) project, explaining the function and purpose of each file and folder.

## Root Directory (`app/`)

-   **`backend/`**: Contains all backend-related code (Python/FastAPI).
    -   **`app/`**: Core FastAPI application code.
        -   **`api/`**: Houses API endpoint definitions (routers).
            -   **`images.py`**: Defines API routes for image upload, listing, retrieval, feature computation start, and status check.
            -   **`roadnet.py`**: Defines API routes for road network generation (`POST /api/road-network/generate-from-prompts`), saving annotations (`POST /api/road-network/save`), and exporting annotations (`POST /api/road-network/export`). Includes mask data support where applicable. **EXPORT (UPDATED)**: Export streams either a single `.pickle` file for the current image or an `all.zip` for all images. Skips images without annotations (counted in headers) and sets `Content-Disposition` and `X-Export-Stats` headers for filename and statistics.
        -   **`core/`**: Contains core application components like configuration.
            -   **`config.py`**: **UPDATED for Phase 1**: Manages application settings, storage paths, model paths. **NEW**: Added batch processing configuration (`FEATURE_COMPUTATION_BATCH_SIZE=16`, `MASK_GENERATION_BATCH_SIZE=8`, `TOPO_CLASSIFICATION_BATCH_SIZE=32`) and memory management settings for large image processing optimization.
        -   **`models/`**: Contains the AI model definitions (PyTorch `nn.Module` classes) for image encoder, prompt encoder, and roadnet decoder.
            -   **`segment_anything/`**: Contains the core components of the Segment Anything Model (SAM), which will be used to construct image encoder, a part of road network generation model.
                -   **`modeling/`**: Likely contains the PyTorch module definitions for different parts of the SAM model (e.g., image encoder, prompt encoder, mask decoder).
                -   **`utils/`**: Contains utility functions supporting the SAM model, possibly for transformations, ONNX export, or other helper tasks.
                -   **`build_sam.py`**: Script or functions for constructing different SAM model variants (e.g., ViT-H, ViT-L, ViT-B).
                -   **`predictor.py`**: Implements the `SamPredictor` class, providing a high-level interface for generating masks from images and prompts using a SAM model.
                -   **`__init__.py`**: Makes the `segment_anything` directory a Python package.
            -   **`road_extraction_algorithm/`**: Contains the integrated road extraction algorithm components based on the provided algorithm documents.
                -   **`__init__.py`**: Initializes the `road_extraction_algorithm` module.
                -   **`config_road_extraction.yaml`**: Configuration file for the `RoadExtractionModel` and inference pipeline parameters.
                -   **`graph_extraction.py`**: **GEOJSON FORMAT OPTIMIZED**: Contains functions for extracting graph points, preparing TopoNet inputs, filtering edges, and converting the graph to GeoJSON format (which now includes `image_id` in the output). Also defines Pydantic models for GeoJSON. **NEW**: Modified `convert_to_geojson()` function to generate node-edge format (v2.0) instead of LineString features, implementing format versioning, comprehensive metadata including `total_nodes`, `total_edges`, and `coordinate_system`. Removed debug print statements and legacy format support for optimized performance. Now exclusively generates structured node-edge format for better storage efficiency and editing capabilities.
                -   **`graph_utils.py`**: Utility functions for graph processing.
                -   **`module.py`**: Defines core PyTorch modules like `DistMaps` and `BilinearSampler`.
                -   **`sam_road_extraction.py`**: Defines the main `RoadExtractionModel` PyTorch module. Integrates components (potentially from SAM) for mask prediction and includes a `TopoNet` for topological connection prediction. Provides methods like `precompute_image_features`, `infer_masks_and_features_from_prompts`, and `infer_toponet`. Now returns road and keypoint masks for quality inspection.
        -   **`schemas/`**: Defines Pydantic models for API requests/responses.
            -   **`image.py`**: Schemas for image API responses.
            -   **`roadnet.py`**: **GEOJSON FORMAT OPTIMIZED + EXPORT SCHEMAS ADDED**: Schemas for road network operations with enhanced node-edge format support. Contains `PointPrompt`, `RoadNetGenerationRequest`, `RoadNetGenerationResponse`, `SaveRoadNetworkRequest`, `SaveRoadNetworkResponse`. **EXPORT (UPDATED)**: Added `ExportRequest` (scope, image_id for current, coordinate_format) and `ExportResponse` (metadata). Export returns streaming content with exposed headers.
        -   **`services/`**: Holds business logic.
            -   **`image.py`**: **UPDATED for Phase 1 Large Image Support**: Implements logic for image handling and feature precomputation with automatic large image detection (>1024x1024). Creates tiled processing with metadata.json for large images, implements batch processing (configurable batch size = 16), handles edge cases with padding, and provides unified status checking. Key new functions: `_run_large_image_feature_computation`, `_process_patches_in_batches`, `_is_large_image`, `_calculate_patch_grid`, `_extract_patch_coordinates`. Maintains backward compatibility with regular images.
            -   **`roadnet_service.py`**: **PHASE 2 IMPLEMENTED + BACKEND CACHING + LOAD OPTIMIZATION + GEOJSON FORMAT OPTIMIZED + EXPORT FUNCTIONALITY**: Implements `process_road_network_generation` with automatic detection of large vs regular images. For regular images, uses existing logic. For large images, routes to `_generate_road_network_for_large_image` with tiled processing. Includes mask data generation, `ensure_features_exist` (helper function), and `save_road_network_annotation` (saves mask data). **NEW**: Large image processing includes patch identification, local inference, and mask fusion. **PERFORMANCE OPTIMIZED**: Implements efficient storage with boolean mask arrays (8x memory reduction), separate compressed .npy files for masks, and optimized JSON format for GeoJSON files. **SAVE/LOAD OPTIMIZATION**: Intelligent compression system with gzip compression for large masks (>1M pixels), automatic format selection between compressed (.gz) and numpy (.npy) files, optimized I/O performance with fast compression levels (level 3), and smart loading with format priority detection for optimal speed. **LOAD TRANSMISSION OPTIMIZATION**: Now uses compressed transmission for load operations via `prepare_compressed_masks_response`, eliminating slow mask loading and reducing transfer times by 70-90%. **BACKEND CACHING**: Automatically caches generated masks for future save operations, eliminating mask transmission overhead. **GEOJSON FORMAT OPTIMIZED**: Simplified to exclusively support node-edge format (v2.0+), removed legacy format compatibility code, enhanced validation for essential node-edge format checks, and optimized processing performance. **EXPORT FUNCTIONALITY**: Added `export_road_networks` function for converting annotations to adjacency list pickle format with support for scope selection (current/all), coordinate format conversion (xy/rc), mask data inclusion, and comprehensive error handling with detailed statistics reporting.
            -   **`large_image_functions.py`**: **PHASE 2 COMPLETE + BACKEND CACHING**: Contains specialized functions for large image processing: `_group_prompts_by_patches` (maps prompts to affected patches), `_load_patch_features` (loads individual patch features), `_generate_batch_masks` (efficient batch inference), `_generate_road_network_for_large_image` (main orchestrator), `_extract_global_graph_points_from_fused_masks` (global NMS node extraction), `_perform_large_image_topology_inference` (topology prediction using centralized patch data). **FULLY IMPLEMENTS**: Complete Phase 2 pipeline from prompt processing to final GeoJSON output including global post-processing, centralized patch data management via `global_data_info` dictionary (containing patch_features, mask_logits, coordinates, and metadata for all processed patches), and cross-patch topology inference. **PERFORMANCE ENHANCED**: Includes intelligent mask compression for transmission (gzip+base64) and storage compression utilities with automatic threshold detection. **SAVE/LOAD OPTIMIZED**: Enhanced compression format with embedded shape headers for reliable decompression, backward compatibility with old formats, and automatic shape inference for edge cases. **BACKEND CACHING**: Integrated with mask cache service for automatic caching of large image masks.
            -   **`mask_cache_service.py`**: **NEW + MEMORY OPTIMIZED**: Implements in-memory caching service for mask data to eliminate repeated transmission between frontend and backend. Features include singleton pattern, automatic cleanup (LRU + expiration), thread-safe operations, and statistics tracking. **PERFORMANCE ENHANCED**: Now stores compressed mask data instead of raw numpy arrays, achieving 80-95% memory reduction with on-demand decompression. Supports both regular and large images with configurable cache size (100 entries) and expiration time (24 hours). Includes detailed memory usage statistics and compression ratio monitoring.
    -   **`storage/`**: Stores persistent data.
        -   **`annotations/`**: Stores final road network annotations (e.g., `{image_id}_roadnetwork.geojson`).
        -   **`features/`**: **UPDATED for Large Images**: For regular images, stores `.pt` files with dict containing 'image_embedding' and 'original_image_size'. For large images (>1024x1024), creates directory `{image_id}/` containing `metadata.json` (image info, grid configuration, computation progress) and individual patch files `patch_{row}_{col}.pt` (each containing image_embedding, patch_coordinates, patch_size, padded_size).
        -   **`images/`**: Stores uploaded images.
    -   **`tests/`**: Backend tests.
    -   **`main.py`**: FastAPI entry point. Initializes app, CORS, loads `RoadExtractionModel` and config into `app.state.model_store` during startup. Includes API routers.
    -   **`requirements.txt`**: Python dependencies.
-   **`frontend/`**: Contains all frontend-related code (React/Vite/TypeScript).
    -   **`public/`**: Static assets directly served (e.g., `vite.svg`).
    -   **`src/`**: Main source code for the React application.
        -   **`assets/`**: Static assets imported into the application code (e.g., `react.svg`).
        -   **`components/`**: Reusable React components.
            -   **`common/`**: General-purpose UI components.
                -   **`ActionButton.tsx`**: Standardized button component with customizable colors and hover effects, used for interaction mode buttons and minimap toggle.
                -   **`MainToolBar.tsx`**: **(NEW + EDITING ENHANCED + RECTANGLE SELECTION)** Unified toolbar containing interaction mode buttons (View/Label/Edit), zoom buttons (In/Out), and utility buttons (Minimap toggle). **EDITING FEATURES**: Enhanced with edit mode tools including AddEdge (line tool with multi-point connection icons) and Modify (hammer emoji) tools, plus snapping toggle controls. Features improved visual design with black text color for better contrast. Edit mode automatically enables snapping and defaults to modify tool for optimal user experience. **RECTANGLE SELECTION UI**: Updated Modify tool tooltip to include Ctrl+Drag rectangle selection instructions for batch node deletion. Replaces separate control components with a single, organized toolbar.
                -   **`StatusOverlay.tsx`**: Separate overlay component for displaying mouse coordinates and legend information at the bottom of the canvas.
                -   **`DownloadProgressOverlay.tsx`**: **(NEW)** Lightweight, reusable overlay to display image download progress with percentage, current network speed, and ETA during large image streaming. Designed to be visually clear, not distracting, and performance-friendly.
                -   **`ResizableSplitter.tsx`**: **(NEW)** Draggable splitter component that allows users to resize the control panel width by dragging the border between control panel and canvas area. Features visual feedback and smooth resizing with configurable minimum and maximum widths.
                -   **`ControlsOverlay.tsx`**: **(DEPRECATED)** Original overlay containing mode/zoom buttons, coordinates, legend. Functionality migrated to MainToolBar and StatusOverlay.
                -   **`ZoomIcons.tsx`**: SVG components for zoom icons.
                -   **`SaveConfirmationDialog.tsx`**: A dialog component to confirm saving or discarding unsaved changes.
                -   **`SaveNotification.tsx`**: A toast-like notification component that displays a save success message with animation.
                -   **`ExportNotification.tsx`**: **(NEW)** Toast-style notification component for displaying export completion messages with statistics in English. Features animated slide-in effects, auto-dismissing behavior, and clear visual feedback for export operations.
            -   **`rendering/`**: **(NEW)** High-performance rendering components for optimized road network display.
                -   **`OptimizedRoadNetworkLayer.tsx`**: **GEOJSON FORMAT OPTIMIZED + EDIT MODE ENHANCED + SPATIAL INDEXING INTEGRATION**: Highly optimized road network rendering component implementing LOD (Level of Detail), viewport culling, and intelligent caching with RBush spatial indexing support. Features three-tier caching system (viewport + LOD + rendered elements), automatic detail reduction during interactions, and Konva performance optimizations. Integrates with OptimizedGeometryManager for efficient spatial queries during rendering operations. Provides significant performance improvements for large road networks. **EDIT MODE SUPPORT**: Enhanced with specialized rendering for edit mode including visual distinction between regular nodes (smaller red circles with 8px radius) and highlighted nodes (green circles with merge indicators) during editing operations, optimized stroke widths for editing precision, and responsive rendering that adapts to different interaction states for optimal editing experience.
            -   **`debug/`**: **(NEW)** Development and debugging components.
                -   **`PerformanceMonitor.tsx`**: **(NEW)** Real-time performance monitoring dashboard displaying rendering statistics, LOD levels, feature counts, and optimization metrics. Development-only component for performance validation and debugging.
            -   **`settings/`**: **(NEW)** User configuration components.
                -   **`PerformanceSettings.tsx`**: **(NEW)** User configuration interface for rendering performance settings. Allows adjustment of LOD parameters, viewport culling, maximum feature counts, line simplification tolerance, and development monitoring controls.
            -   **`editor/`**: Components specific to the map/annotation editor interface.
                -   **`ActionButtons.tsx`**: Contains buttons for triggering road network generation (now with feature computation status display) and saving via store actions.
                -   **`FeatureStatusDisplay.tsx`**: Shows image feature status and allows triggering computation via store.
                -   **`ImageSelector.tsx`**: **UI ENHANCED + NAVIGATION + UNIFIED LOGIC**: Handles image selection through a scrollable list interface with sequence numbers, progress tracking, and navigation controls. Features real file uploading (single/directory) via API/store. **NEW**: Added sequence numbering, progress section with annotation statistics, previous/next navigation buttons with ActionButton integration, and smart boundary condition handling. **LOGIC FIX**: Modified navigation buttons to only call unified `requestImageSwitch` instead of direct store methods, ensuring consistent save confirmation behavior across all image switching methods.
                -   **`PromptController.tsx`**: **ENHANCED UI + MOUSE INTERACTION**: Manages the display and interaction for positive/negative prompt points with streamlined design. **NEW**: Removed prompt type selector buttons in favor of intuitive left-click (positive) and right-click (negative) prompt addition. Features compact layout with reduced height and expanded scrollable list area, plus clear instruction text for improved user experience.
                -   **`LayerControls.tsx`**: Renders checkboxes to toggle the visibility of canvas layers (Image, Prompts, Network, Road Mask, Keypoint Mask, Patch Grid) via `uiStore`. **ENHANCED**: Added performance indicators for large road networks with visual warnings and optional performance mode settings.
                -   **`Minimap.tsx`**: Renders a small overview map with a draggable viewport indicator. Features performance optimizations with simplified rendering during interactions. Supports patch grid overlay display.
                -   **`PatchGridOverlay.tsx`**: **(NEW)** Component for displaying patch grid overlay with dashed lines to visualize how large images are divided into patches. Supports offset and scaling for minimap integration.

            -   **`layout/`**: Components defining the overall page structure.
                -   **`CanvasArea.tsx`**: **GEOJSON FORMAT OPTIMIZED + STREAMING IMAGE LOADING + ADVANCED EDIT MODE SYSTEM + SPATIAL INDEXING OPTIMIZATION + RECTANGLE SELECTION**: Renders the main image display and interaction area using `react-konva`. Handles image loading (small images: direct preload; large images: streaming with progress overlay), pan/zoom, prompts, road network, road/keypoint masks, patch grid, and layer visibility. Integrates Minimap, MainToolBar, and StatusOverlay. Uses `DownloadProgressOverlay` for progress UI during streaming, designed to be lightweight.
                -   **`ControlPanel.tsx`**: Container for the left-side panel holding editor components, including LayerControls. Now supports dynamic width adjustment through ResizableSplitter integration and features improved compact styling throughout all child components. Includes custom CSS module for enhanced scrollbar styling.
                -   **`ControlPanel.module.css`**: **(NEW)** CSS module providing custom scrollbar styling for the control panel, making scrollbars thinner and more aesthetically pleasing with smooth hover transitions.
                -   **`Header.tsx`**: Top navigation bar component.
                -   **`StatusBar.tsx`**: Bottom status bar displaying application state (now includes automatic feature computation status, current interaction mode, and minimap visibility status) from multiple stores.
            -   **`ToolBar.tsx`**: **EXPORT FUNCTIONALITY (UPDATED)**: Left-most toolbar provides an Export button opening a refined dialog. Options: scope (current/all), coordinate format (xy/rc). Current mode downloads `<original>.pickle` if annotated, otherwise shows a message without downloading. All mode downloads `all.zip` with per-image pickle files and a toast notification showing exported/missing counts. Dialog auto-closes shortly after successful export.
        -   **`hooks/`**: Directory for custom React hooks.
            -   **`useGlobalHotkeys.ts`**: **NAVIGATION ENHANCED + UNIFIED LOGIC**: Defines and manages global keyboard shortcuts using `hotkeys-js`. **NEW**: Modified keyboard navigation (Left/Right arrows) to emit events instead of directly calling store methods, ensuring all image switching goes through unified save confirmation logic via `requestImageSwitch`.
            -   **`useProgressiveImage.ts`**: Custom React hook for optimized image loading. For large images (>2MB), uses streaming with real-time progress (percentage, speed, ETA) and graceful fallback to chunked only when necessary; small images are directly preloaded. WebP is not preferred by default.

        -   **`services/`**: Modules for interacting with the backend API or providing services.
            -   **`api.ts`**: **REQUEST CANCELLATION OPTIMIZED + STREAMING IMAGE DOWNLOADS + EXPORT API ADDED**: Provides streaming downloads for large images (`downloadImageStreaming`) with progress callbacks and a simplified `loadImageOptimized` that chooses streaming for large files and direct preload for small files. `exportRoadNetworks` posts to `/api/road-network/export` and parses `X-Export-Stats`.
        -   **`store/`**: Zustand state management stores.
            -   **`imageStore.ts`**: **NAVIGATION ENHANCED**: Manages state related to images, including fetching/uploading via `api.ts`.Added navigation functions `switchToPreviousImage` and `switchToNextImage` with smart boundary condition handling for seamless image browsing workflow.
            -   **`promptStore.ts`**: **ENHANCED API**: Manages state related to user-added prompts with modernized interface. **NEW**: Modified `addPrompt` function to accept optional type parameter `addPrompt(point, type?)`, removing dependency on global `activePromptType` state. Maintains backward compatibility with default positive type. Streamlined state management by removing unused `activePromptType` and `setActivePromptType` functions.
                          -   **`roadNetworkStore.ts`**: **GEOJSON FORMAT OPTIMIZED + ADVANCED EDIT MODE SYSTEM + SPATIAL INDEXING OPTIMIZATION + RECTANGLE SELECTION + REQUEST CANCELLATION**: Manages state related to the generated road network. Now includes feature computation tracking (`isComputingFeatures`), road mask, and keypoint mask data for quality inspection. **BACKEND CACHING OPTIMIZATION**: Modified save operations to use backend cached masks instead of transmitting mask data, significantly reducing payload sizes and improving save performance. **SPATIAL INDEXING INTEGRATION**: Uses optimized geometry utilities with RBush spatial indexing for O(log n) performance in node operations, snap detection, and rectangle selection. **COMPREHENSIVE EDIT MODE SYSTEM**: Implements complete editing functionality including edit mode state management (AddEdge, Modify, snapping enabled/disabled), intelligent node operations (addNode, moveNode with optional undo recording, deleteNode), edge operations (addEdge, deleteEdge), advanced polyline creation system (addPointToPolyline with real-time snap detection, finishPolyline with two-pass node merging algorithm), node movement with snapping (moveNodeWithSnapping for intelligent merge-on-drop), comprehensive undo/redo system (pushToUndoStack, undo, redo with complete state restoration), and smart edit mode defaults (automatic snapping enable and modify tool selection on edit mode entry). **RECTANGLE SELECTION SYSTEM**: Added multi-node selection state management (`selectedNodes`, `isRectangleSelecting`, `rectangleSelection`), rectangle selection operations (`selectNodesInRectangle`, `updateRectangleSelection`), batch deletion functionality (`deleteSelectedNodes` with efficient Set-based node filtering), and comprehensive selection state management for complex editing workflows. **PERFORMANCE ENHANCED**: Enhanced `loadSavedRoadNetwork` with AbortSignal support for request cancellation, intelligent AbortError handling to prevent false error states, and proper loading state management for interrupted operations.
            -   **`uiStore.ts`**: Manages UI-specific state, such as the canvas interaction mode (View/Label/Edit), layer visibility (now including roadMask, keypointMask, and patchGrid), and minimap visibility toggle. **PERFORMANCE ENHANCED**: Added comprehensive performance settings management including LOD controls, viewport culling options, feature limits, and simplification parameters for rendering optimization.
        -   **`types/`**: TypeScript type definitions and interfaces.
            -   **`index.ts`**: **GEOJSON FORMAT OPTIMIZED + EXPORT TYPES ADDED**: Defines common types (`ImageInfo`, `Prompt`, `RoadNetworkData` - GeoJSON FeatureCollection) and API response interfaces (`ImageListResponse`, `UploadResponse`, `FeatureStatusResponse`, `PrecomputeResponse`, `RoadNetGenerationResponse` - containing `geojson_data`, `road_mask` and `kp_mask`). **NEW**: Enhanced type definitions for node-edge format with `RoadNode` and `RoadEdge` types. Updated `GeoJSONFeatureCollection` with required `nodes` and `edges` fields, removed legacy format optionality for improved type safety. **EXPORT FUNCTIONALITY**: Added `ExportOptions` and `ExportResponse` interfaces for comprehensive export functionality with scope selection, format options, and detailed response statistics.
        -   **`utils/`**: Directory for utility functions.
            -   **`eventBus.ts`**: Simple pub/sub event emitter for decoupled communication (e.g., hotkeys to canvas zoom).
            -   **`promptUtils.ts`**: Utility functions for handling prompts, including ensuring unique IDs, maintaining prompt types, and canvas focus management for hotkeys to work correctly when switching images.
            -   **`maskUtils.ts`**: **(NEW)** Comprehensive mask processing utilities for large image optimization. Includes `createMaskCanvas` for efficient mask rendering, `processMaskWithWorker` for Web Worker-based processing of large masks, `shouldUseWorkerProcessing` for intelligent processing mode detection, `estimateMaskProcessingTime` for performance monitoring, and decompression utilities for gzip/base64 encoded mask data. Supports both synchronous and asynchronous processing modes with automatic performance optimization.
            -   **`renderingOptimization.ts`**: **(NEW)** Core rendering performance optimization utilities. Implements LOD (Level of Detail) system with 5 detail levels, viewport culling with bounding box intersection testing, line simplification using Douglas-Peucker-style algorithm, and performance utilities (debounce/throttle). Provides comprehensive tools for optimizing road network rendering performance across different zoom levels and interaction states.
            -   **`roadNetworkUtils.ts`**: **(GEOJSON FORMAT OPTIMIZED)** Essential utilities for node-edge operations. **SIMPLIFIED**: Removed legacy format conversion functions, storage analysis functions, and debug utilities. Now contains only basic node/edge utilities required for the optimized v2.0 format including node extraction, edge processing, and data validation. Focused on core functionality without legacy compatibility overhead for improved performance and maintainability.
            -   **`optimizedGeometryUtils.ts`**: **(NEW + SPATIAL INDEXING OPTIMIZATION)** High-performance geometry utilities with RBush spatial indexing for fast geometric queries. **CORE FEATURES**: OptimizedGeometryManager class with O(log n) spatial searches, precomputed adjacency lists and node degrees for instant graph operations, efficient spatial rectangle selection with bounding box queries, and unified optimization approach for all road networks.**API**: Exports all optimized geometry functions including pointDistance, pointToLineDistance, calculateDistance, getNearestSnapNode, findNodesAtPosition, mergeNodes, and rectangle selection utilities. Automatically initializes spatial indexing for seamless integration.
            -   **`geometryUtils.ts`**: **(CONSOLIDATED + RE-EXPORT OPTIMIZATION)** Streamlined geometry utilities module with eliminated code redundancy. **UNIQUE FUNCTIONS**: Retains specialized functions including getEdgeMidpoint (edge midpoint calculations), generateUniqueId (ID generation), polylineToNodesAndEdges (polyline conversion), and applySnapping (snapping logic). **RE-EXPORTS**: Provides API compatibility by re-exporting optimized functions from optimizedGeometryUtils including Point type, distance calculations, and spatial operations.
        -   **`App.css`**: Default Vite CSS styles for the App component.
        -   **`App.tsx`**: **UNIFIED LOGIC + LAYOUT MANAGEMENT + REQUEST CANCELLATION**: Root React component assembling main layout with comprehensive image switching logic. Includes control panel width management state and ResizableSplitter integration for dynamic panel resizing. **NEW**: Added unified save confirmation system through `requestImageSwitch` function, handles all image switching scenarios (list clicks, navigation buttons, keyboard shortcuts) consistently. Features event-based keyboard navigation handling and robust save/discard dialog management for unsaved changes. **PERFORMANCE ENHANCED**: Implements AbortController-based request cancellation system for interrupting previous image loading operations during rapid image switching, preventing resource waste and race conditions. Includes proper cleanup on component unmount and intelligent error handling for aborted requests.
        -   **`index.css`**: Main CSS file, includes base styles and Tailwind directives.
        -   **`main.tsx`**: Application entry point, renders the root React component.
        -   **`vite-env.d.ts`**: TypeScript definitions for Vite environment variables.
    -   **`node_modules/`**: Contains installed npm packages.
    -   **`.gitignore`**: Frontend Git ignore file.
    -   **`eslint.config.js`**: ESLint configuration.
    -   **`index.html`**: HTML entry point for Vite development.
    -   **`package.json`**: Frontend project metadata, dependencies, scripts.
    -   **`package-lock.json`**: Records exact frontend dependency versions.
    -   **`postcss.config.js`**: PostCSS configuration.
    -   **`README.md`**: Frontend-specific documentation.
    -   **`tailwind.config.js`**: Tailwind CSS configuration.
    -   **`tsconfig.*.json`**: TypeScript configurations.
    -   **`vite.config.ts`**: Vite configuration.
